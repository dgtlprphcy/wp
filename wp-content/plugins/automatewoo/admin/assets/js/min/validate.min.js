!function($,localizedErrorMessages){var self;AW.Validate={errorMessages:{},init:function(){setInterval(function(){"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave(),$(".automatewoo-field-wrap textarea.wp-editor-area").each(function(){$(this).attr("data-automatewoo-validate","variables"),self.validateField($(this))})},2e3),$(document.body).on("keyup blur change","[data-automatewoo-validate]",function(event){self.validateField($(event.target))}),self.validateAllFields()},validateAllFields:function(){$("[data-automatewoo-validate]").each(function(){self.validateField($(this))})},validateField:function($field){if(AW.workflow){var errors=[],text=$field.val();self.clearFieldErrors($field);var usedVariables=AW.Validate.getVariablesFromText(text);if(self.fieldSupports("variables",$field)){var trigger=AW.workflow.get("trigger");_.each(usedVariables,function(variable){var valid=self.isVariableValidForTrigger(variable,trigger);!0!==valid&&errors.push(self.getErrorMessage(valid,self.getVariableWithoutParams(variable)))})}else usedVariables&&errors.push(self.getErrorMessage("noVariablesSupport"));errors.length&&self.setFieldErrors($field,errors)}},setFieldErrors:function($field,errors){$field.addClass("automatewoo-field--invalid");var $wrap=$field.parents(".automatewoo-field-wrap:first");$wrap.append('<div class="automatewoo-field-errors"></div>');var $errors=$wrap.find(".automatewoo-field-errors");$field.is(".wp-editor-area")&&$wrap.find(".wp-editor-container").addClass("automatewoo-field--invalid"),_.each(errors,function(error){$errors.append('<div class="automatewoo-field-errors__error">'+error+"</div>")})},clearFieldErrors:function($field){var $wrap=$field.parents(".automatewoo-field-wrap:first");$field.removeClass("automatewoo-field--invalid"),$field.is(".wp-editor-area")&&$wrap.find(".wp-editor-container").removeClass("automatewoo-field--invalid"),$wrap.find(".automatewoo-field-errors").remove()},fieldSupports:function(option,$field){var options=$field.data("automatewoo-validate").split(" ");return-1!==_.indexOf(options,option)},isVariableValidForTrigger:function(variable,trigger){var dataType=self.getDataTypeFromVariable(variable),dataField=self.getDataFieldFromVariable(variable);if(dataType&&-1===_.indexOf(trigger.supplied_data_items,dataType))return"invalidDataType";var variables=AW.workflow.get("variables");return!variables||!variables[dataType]||-1!==variables[dataType].indexOf(dataField)||"invalidVariable"},getVariablesFromText:function(text){var variables=text.match(/{{(.*?)}}/g);return!!variables&&(_.each(variables,function(variable,i){variables[i]=variable.replace(/{|}/g,"").trim()}),variables)},getVariableWithoutParams:function(variable){return variable.replace(/(\|.*)/,"")},getDataTypeFromVariable:function(variable){return-1!==variable.indexOf(".")&&variable.replace(/(\..*)/,"")},getDataFieldFromVariable:function(variable){var dotpos=(variable=self.getVariableWithoutParams(variable)).indexOf(".");return-1!==dotpos&&variable.substring(dotpos+1).trim()},getErrorMessage:function(error,replace){if(!self.errorMessages[error])return"Unknown error, please try refreshing your browser.";var message=self.errorMessages[error];return"string"==typeof replace&&(message=message.replace("%s",replace)),message}},(self=AW.Validate).errorMessages=localizedErrorMessages}(jQuery,automatewooValidateLocalizedErrorMessages);